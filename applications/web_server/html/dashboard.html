<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
    <h1 class="h2">CPU USAGE (%)</h1>
</div>
<style>
    canvas{
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
    }
    .chart-container {
        width: 500px;
        margin-left: 40px;
        margin-right: 40px;
        margin-bottom: 40px;
    }
    .cpu_chart_canvas {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: center;
    }
</style>
<div id="chart-container">
    <canvas id="cpu_chart_canvas"></canvas>
</div>
<!-- ChartJs -->
<script src="/js/plugins/chartjs/Chart.bundle.js"></script>
<script>

$(function () {
    $("#main_menu").find("a[href='/pages/dashboard']").addClass("active")
});

//////////////////////////////////////////////////////
    // CPU chart setup
//////////////////////////////////////////////////////

var second_datas = [];
for(i = 60; i >= 0; i--) {
    second_datas.push(i);
}

var cpu_percents = [20];
for(i = 0; i <= 60; i++) {
    
    latest = cpu_percents[cpu_percents.length - 1];
    
    var prev = cpu_percents.length > 0 ? cpu_percents[cpu_percents.length - 1] : 50
    y = prev + Math.random() * 10 - 5;
    if (y < 0) { y = 0; } else if (y > 100) { y = 100; }

    cpu_percents.push(Math.floor(y));
}
var config = {
    type: 'line',
    data: {
        labels: second_datas,
        datasets: [{
            label: 'CPU Percents',
            backgroundColor: 'rgb(255, 99, 132)',
            borderColor: 'rgb(255, 99, 132)',
            data: cpu_percents,
            fill: true,
        }]
    },
    options: {
        responsive: true,
        title: { display: false, text: 'CPU USAGE (%)'},
        tooltips: { mode: 'index', intersect: false, },
        hover: { mode: 'nearest', intersect: true },
        scales: {
            xAxes: [{
                display: false,
                scaleLabel: { display: false, labelString: 'Seconds' },
                // ticks: { min: 0, max: 40, stepSize: 5, reverse: false, },
            }],
            yAxes: [{
                display: true,
                scaleLabel: { display: false, labelString: 'Percents' },
                ticks: { min: 0, max: 100, stepSize: 10, reverse: false, },
            }]
        }
    }
};

var realtime = 'on';

function updateRealTime() {

    if (config.data.datasets.length > 0) {
        config.data.datasets.forEach(function(dataset) {
            var prev = dataset.data.length > 0 ? dataset.data[dataset.data.length - 1] : 50
            y = prev + Math.random() * 10 - 5;
            if (y < 0) { y = 0; } else if (y > 100) { y = 100; }

            dataset.data.push(Math.floor(y));
        });

        config.data.datasets.forEach(function(dataset) {
            dataset.data.splice(0, 1);
        });
    }

    window.myLine.update();

    var timeout;
    if (realtime === 'on') {
        timeout = setTimeout(updateRealTime, 1000);
    } else {
        clearTimeout(timeout);
    }
}

window.onload = function() {
    var ctx = document.getElementById('cpu_chart_canvas').getContext('2d');
    window.myLine = new Chart(ctx, config);
    updateRealTime();
};

</script>