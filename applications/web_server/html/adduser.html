<!--div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
    <h1 class="h2">Firmware</h1>
</div-->
<div class="container">
  <div class="status"></div>
  <h3>Add user information</h3>
  <form action="/json/users" method="post" enctype="multipart/form-data" id="js-add_user-form">
    <div class="form-group">
      <label for="fullname">Full Name:</label>
      <input type="text" class="form-control" id="fullname" placeholder="Enter full name" name="fullname">
    </div>
    <div class="form-group">
      <label for="user_name">User Name:</label>
      <input type="text" class="form-control" id="user_name" placeholder="Enter user name" name="user_name">
    </div>
    <div class="form-group">
      <label for="password">Password:</label>
      <input type="password" class="form-control" id="password" placeholder="Enter password" name="password">
    </div>
    <div class="form-group">
      <label for="repassword">Password Confirm:</label>
      <input type="password" class="form-control" id="repassword" placeholder="Enter password confirm" name="repassword">
      <div id="checkpassword"></div>
    </div>
    <div class="form-group">
      <label for="email">Email:</label>
      <input type="email" class="form-control" id="email" placeholder="Enter email" name="email">
    </div>
    <input type="hidden" name="action" value="add">
    <button type="submit" class="btn btn-default" id="submit" disabled>Add</button>
  </form>
</div> <!-- /container -->

<script>

$(function () {
    $("#myTopnav").find("a[href='/pages/users']").addClass("active")
});

function checkPasswordMatch() {
    var password = $("#password").val();
    var rePassword = $("#repassword").val();

    $("#checkpassword").empty();
    if (password != rePassword){
        $("#checkpassword").html("Passwords do not match!");
        $('#submit').prop('disabled', true);
    } else {
        $("#checkpassword").html("Passwords match!");
        $('#submit').prop('disabled', false);
    }
}

$(document).ready(function () {
    $("#password, #repassword").keyup(checkPasswordMatch);
});

function post_form_data($, id, onSuccess) {

    var formData = new FormData();
    $.each($('#' + id +' [name]'), function(i, elem) {
        formData.append($(elem).attr('name'), $(elem).val());
    });

    $.ajax({
        type: "POST",
        url: $('#' + id).attr('action'),
        data: formData,
        enctype: 'multipart/form-data',
        processData: false,
        contentType: false,
        cache: false,

        success: onSuccess,
    });
}

(function($) {

    var addUserForm = document.getElementById('js-add_user-form');

    addUserForm.addEventListener('submit', function(e) {
        e.preventDefault();
        post_form_data($, 'js-add_user-form', function(json) {
        $(".status").empty();
        if (json.status == "succeeded") {
          $(".status").append("<div class=\"alert alert-success\"> <strong>Success!</strong></div>");
          setTimeout(function(){
            window.location.href = "/pages/users";
          }, 1500);
        } else {
          $(".status").append("<div class=\"alert alert-danger\"> <strong>Error!</strong> " + json.message + "</div>");
        }
        });
    })

})(jQuery);
</script>
