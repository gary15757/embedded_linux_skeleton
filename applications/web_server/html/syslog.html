<div class="container">
  <div class="panel panel-default">
    <div class="panel-body">
      <h3>System Log</h3>
      <div class="container">
        <form style="margin-left:100px; padding-bottom:10px" class="form-inline">
          <div class="form-group mx-sm-3 mb-2">
            <input style="width:350px" type="text" class="form-control" id="filter_input" placeholder="Filter">
          </div>
          <button style="width: 100px" type="button" class="btn btn-primary mb-2 btn-md" id="syslog-filter">Filter</button>
        </form>
      </div>
      <textarea class="form-control" rows="20" id="text_log" readonly></textarea>
      <br>
      <div class="col-md-12 text-center">
        <button type="button" class="btn btn-info " id="syslog-refresh">Refresh</button>
      </div>
    </div>
  </div>
</div> <!-- /container -->
<script>

$(function () {
    $("#myTopnav").find("a[href='/pages/syslog']").addClass("active")
});

+ function($) {
    'use strict';

    $(document).ready(function(){
        showSyslog();
        $( "#syslog-refresh" ).click(function() {
            showSyslog();
            document.getElementById('filter_input').value = "";
        });

        $( "#syslog-filter" ).click(function() {
            var input = document.getElementById("filter_input").value;
            if (input == "")
            {
                showSyslog();
            } else
            {
                showFilter(input);
            }
        });
    });

    function showFilter(input) {
        $.getJSON( "/json/syslog", function(data) {
            var syslog = JSON.stringify(data);
            var parseSyslog = JSON.parse(syslog);
            var splitSyslog = parseSyslog.syslog.split("\n");
            var i;
            var newSyslog = "";
            for (i = 0; i < splitSyslog.length; i++)
            {
                if (splitSyslog[i].indexOf(input) !== -1)
                {
                    newSyslog += splitSyslog[i];
                    newSyslog += "\n";
                }
            }
            var text_log = $('#text_log')[0];
            text_log.value = newSyslog;
            text_log.scrollTop = text_log.scrollHeight;
        });
    }

    function showSyslog() {
        $.getJSON( "/json/syslog", function(data) {
            var text_log = $('#text_log')[0];
            text_log.value = data.syslog;
            text_log.scrollTop = text_log.scrollHeight;
        });
    }
}(jQuery);

</script>
